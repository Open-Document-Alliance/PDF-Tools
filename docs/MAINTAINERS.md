# Maintainer Onboarding and Operations

This doc is for maintainers of PDF Tools. It focuses on how the Anthropic
extension and MCP server are wired, how to package releases, and how to keep
up with upstream MCP changes.

## Quick orientation

- This repo ships a single MCP server at `server/index.js` used by both
  Claude Desktop (extension) and Cursor (MCP server).
- The Claude Desktop package is built from `manifest.mcpb.json`.
- The Cursor share package mirrors code in `pdf-toolkit-mcp-share/` and is
  generated by `package-for-friend.js`.

## Maintainer quickstart

```
npm install
node server/index.js
mcpb pack
node package-for-friend.js
```

Use a local MCP host (Claude Desktop or Cursor) to validate tools. Run the
manual checklist before publishing (see below).

## Architecture (high level)

- `server/index.js` is the MCP server entry point.
- Tool definitions and helpers live in `server/index.js`.
- Profile storage lives under `~/.pdf-filler-profiles`.
- PDF utilities use `pdf-lib`, `pdf-parse`, and `pdfjs-dist`.
- OCR/image extraction is lazy loaded to avoid startup overhead.

## Data flow (ASCII map)

```
Claude Desktop / Cursor
        │
        ▼
   MCP transport
        │
        ▼
  server/index.js
        │
        ├─ form fill/read (pdf-lib)
        ├─ text extract (pdf-parse)
        └─ OCR/image (pdfjs-dist + canvas)
        │
        ▼
 local filesystem
```

## Tool inventory (current)

Tools are listed in `CLAUDE.md` and in `server/index.js`. Keep the list
stable and in sync across:

- `CLAUDE.md` tool list
- README tool list
- Actual tool registrations in `server/index.js`

## Local dev

```
npm install
node server/index.js
```

Use a local MCP host (Claude Desktop or Cursor) and point it at
`server/index.js`.

## Packaging and release flow

### Claude Desktop (.mcpb)

- Uses `manifest.mcpb.json`.
- Build with:

```
npm install -g @anthropic-ai/mcpb
mcpb pack
```

### Cursor share package

- Mirrors source in `pdf-toolkit-mcp-share/`.
- Generate with:

```
node package-for-friend.js
```

### Versioning and alignment

When publishing, update versions together:

- `package.json`
- `manifest.json`
- `manifest.mcpb.json`
- `pdf-toolkit-mcp-share/` bundle metadata (if applicable)

Do not commit binary artifacts (zip, mcpb) to main. Attach them to
releases instead.

## Manual test checklist

Run these after any tool or packaging change:

- `list_pdfs` against a local directory
- `read_pdf_fields` on `example-fw9.pdf`
- `fill_pdf` on `example-fw9.pdf`
- `save_profile`, `load_profile`, `fill_with_profile`
- `bulk_fill_from_csv` using a two-row CSV with a comma in one value
- `extract_to_csv` on two PDFs
- `validate_pdf` on a partially filled form
- `read_pdf_content` on text and scanned PDFs
- `get_pdf_resource_uri` with a local path

## Upstream tracking (MCP + MCPB)

We depend on MCP specs and the MCPB packaging tool. Keep these current:

- MCP spec and SDK: https://github.com/modelcontextprotocol
- MCPB CLI: https://github.com/modelcontextprotocol/mcpb
- SDK package: `@modelcontextprotocol/sdk` (see `package.json`)

Suggested maintenance routine:

- Watch the MCPB repo for releases and breaking changes.
- Track `@modelcontextprotocol/sdk` via Dependabot/Renovate.
- Revalidate Claude Desktop packaging on MCPB major updates.

## Support and escalation

- Use GitHub Issues for bugs/feature requests.
- Ask for minimal repro steps and scrubbed PDFs/CSVs.
- Confirm the MCP host (Claude Desktop vs Cursor) and version.
- If a change affects packaging, re-run the manual checklist.

## Notes and lessons learned

- Keep tool names snake_case and stable; many clients persist tool IDs.
- Avoid hard-coded paths; always use `resolvePath` and default directories.
- Prefer incremental updates to `server/index.js` to reduce packaging churn.
